<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roode v2.0 (No Wrap)</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --sidebar-color: #252526;
            --text-color: #d4d4d4;
            --accent-color: #007acc;
            --line-number-color: #858585;
            --header-height: 40px;
            
            /* –ï–î–ò–ù–´–ô –®–†–ò–§–¢ –í–ï–ó–î–ï */
            --editor-font: 'Consolas', 'Monaco', 'Courier New', monospace;
            --editor-size: 14px;
            --editor-line-height: 20px; 
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg-color); color: var(--text-color);
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; font-family: -apple-system, sans-serif;
        }

        /* HEADER */
        header {
            height: var(--header-height); background: #333;
            display: flex; align-items: center; padding: 0 10px;
            justify-content: space-between; border-bottom: 1px solid #111; user-select: none;
        }
        .controls { display: flex; gap: 6px; }
        .logo { font-weight: bold; color: white; margin-right: 10px; font-size: 14px;}
        .btn {
            border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; color: white; 
            font-size: 11px; display: flex; align-items: center; transition: 0.2s; white-space: nowrap;
        }
        .btn-blue { background: var(--accent-color); } .btn-blue:hover{background:#0062a3;}
        .btn-green { background: #238636; } .btn-green:hover{background:#2ea043;}
        .btn-gray { background: #444; } .btn-gray:hover{background:#555;}

        /* MAIN LAYOUT */
        .workspace { display: flex; flex: 1; height: calc(100vh - var(--header-height) - 25px); }

        .sidebar {
            width: 250px; background: var(--sidebar-color);
            border-right: 1px solid #333; display: flex; flex-direction: column;
        }
        .sidebar-header {
            padding: 10px 15px; font-size: 11px; font-weight: bold; color: #aaa;
            text-transform: uppercase; background: #2b2b2c; display: flex; justify-content: space-between;
        }
        .file-list { flex: 1; list-style: none; padding: 0; margin: 0; overflow-y: auto; }
        .file-item {
            padding: 4px 15px; display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; color: #ccc; cursor: pointer; border-left: 3px solid transparent;
        }
        .file-item:hover { background: #2a2d2e; }
        .file-item.active { background: #37373d; border-left-color: var(--accent-color); color: #fff; }
        .del-btn { opacity: 0; color: #666; font-weight: bold; margin-left: 5px; }
        .file-item:hover .del-btn { opacity: 1; } .del-btn:hover { color: #f44; }

        .editor-container {
            flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg-color); min-width: 0;
        }
        .tab-bar { height: 35px; background: #252526; display: flex; align-items: center; }
        .tab { 
            padding: 0 15px; height: 100%; display: flex; align-items: center;
            background: #1e1e1e; font-size: 13px; border-top: 2px solid var(--accent-color);
        }

        /* EDITOR AREA */
        .code-wrapper {
            flex: 1; display: flex; position: relative; overflow: hidden; 
        }

        /* NUMBERS COLUMN */
        .gutter {
            width: 45px; flex-shrink: 0;
            background: #1e1e1e; color: var(--line-number-color);
            text-align: right; border-right: 1px solid #333;
            user-select: none; 
            overflow: hidden; /* –°–∫—Ä–æ–ª–ª–∏—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º */
            padding-top: 10px; /* –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å textarea */
            box-sizing: border-box;
        }
        .line-num {
            height: var(--editor-line-height); /* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –í–´–°–û–¢–ê */
            line-height: var(--editor-line-height);
            font-family: var(--editor-font);
            font-size: var(--editor-size);
            padding-right: 8px;
        }

        /* TEXT INPUT */
        textarea#editor {
            flex: 1;
            background: transparent; border: none; outline: none; resize: none;
            color: var(--text-color);
            padding: 10px;
            box-sizing: border-box;
            
            font-family: var(--editor-font);
            font-size: var(--editor-size);
            line-height: var(--editor-line-height);
            tab-size: 4;

            /* == –ì–õ–ê–í–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï == */
            white-space: pre;   /* –û–¢–ö–õ–Æ–ß–ê–ï–ú –ü–ï–†–ï–ù–û–° –°–¢–†–û–ö */
            overflow-x: scroll; /* –†–∞–∑—Ä–µ—à–∞–µ–º –≥–æ—Ä–∏–∑. —Å–∫—Ä–æ–ª–ª */
            overflow-y: scroll; 
        }

        /* SCROLLBAR STYLE */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #424242; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #4f4f4f; }
        /* –£–≥–æ–ª–æ–∫ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar-corner { background: #1e1e1e; }

        footer { height: 25px; background: var(--accent-color); display: flex; align-items: center; padding: 0 15px; color: white; font-size: 11px; }

        /* Modal */
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:99;}
        .modal { background: #252526; padding: 20px; width: 300px; border:1px solid #444; text-align:center;}
        .modal input { width: 90%; padding: 5px; margin: 10px 0; background: #3c3c3c; border: 1px solid #555; color: #fff;}

    </style>
</head>
<body>

<header>
    <div class="logo">Roode <span style="font-size:10px;opacity:0.5">2.0</span></div>
    <div class="controls">
        <button class="btn btn-blue" onclick="selFolder()">üìÇ –ü–∞–ø–∫–∞</button>
        <button class="btn btn-green" onclick="showNew()">‚ûï –°–æ–∑–¥–∞—Ç—å</button>
        <button class="btn btn-gray" onclick="save()">üíæ</button>
        <button class="btn btn-gray" onclick="selFiles()">üìÑ –û—Ç–¥. –§–∞–π–ª—ã</button>
    </div>
</header>

<div class="workspace">
    <div class="sidebar">
        <div class="sidebar-header">
            <span id="labelHeader">–ü–†–û–í–û–î–ù–ò–ö</span>
            <span style="cursor:pointer" onclick="listRender()">‚Üª</span>
        </div>
        <ul id="listUI" class="file-list"></ul>
    </div>
    <div class="editor-container">
        <div class="tab-bar"><div class="tab" id="tabInfo">...</div></div>
        
        <div class="code-wrapper">
            <div id="gutter" class="gutter"></div>
            <!-- Textarea —Å white-space: pre -->
            <textarea id="editor" spellcheck="false" placeholder="// –í —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ —Ç–µ–∫—Å—Ç —É—Ö–æ–¥–∏—Ç –≤–ø—Ä–∞–≤–æ..."></textarea>
        </div>
    </div>
</div>

<footer><div id="msg">–ì–æ—Ç–æ–≤</div></footer>

<div class="overlay" id="mod"><div class="modal">
    <h3>–ù–æ–≤—ã–π —Ñ–∞–π–ª</h3><input id="fname"><br>
    <button class="btn btn-blue" onclick="createFile()">OK</button>
    <button class="btn btn-gray" onclick="document.getElementById('mod').style.display='none'">X</button>
</div></div>

<script>
    // VARS
    let fHandle=null, fileH=null, isDir=false, filesCache=[];
    const ed = document.getElementById('editor');
    const gut = document.getElementById('gutter');
    const ui = document.getElementById('listUI');
    const msg = document.getElementById('msg');
    const tab = document.getElementById('tabInfo');
    const label = document.getElementById('labelHeader');

    // == –õ–û–ì–ò–ö–ê –û–¢–†–ò–°–û–í–ö–ò –°–¢–†–û–ö ==
    // –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è, —Ç–∞–∫ –∫–∞–∫ –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
    function updateLines() {
        const val = ed.value;
        // –ü—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–µ–º —Å–∏–º–≤–æ–ª—ã \n
        const linesCount = val.split('\n').length;
        
        let html = '';
        for(let i=0; i < linesCount; i++){
            html += `<div class="line-num">${i+1}</div>`;
        }
        gut.innerHTML = html;
    }

    ed.addEventListener('input', updateLines);
    
    // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –°–ö–†–û–õ–õ–ê (–¢–û–õ–¨–ö–û –í–ï–†–¢–ò–ö–ê–õ–¨–ù–û)
    ed.addEventListener('scroll', () => {
        gut.scrollTop = ed.scrollTop;
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à (—á—Ç–æ–±—ã —Ü–∏—Ñ—Ä—ã –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter)
    ed.addEventListener('keydown', ()=> setTimeout(updateLines,0));

    // –°–ò–°–¢–ï–ú–ê
    async function selFolder() {
        try {
            fHandle = await window.showDirectoryPicker();
            isDir = true; label.textContent = fHandle.name.toUpperCase();
            fileH = null; ed.value = ''; tab.textContent = "---"; updateLines();
            listRender();
        } catch(e){}
    }

    async function selFiles() {
        try {
            filesCache = await window.showOpenFilePicker({multiple:true, types:[{description:'Code',accept:{'text/plain':['.prsh','.prshx','.txt']}}]});
            isDir = false; fHandle = null; label.textContent = "–§–ê–ô–õ–´";
            fileH = null; ed.value = ''; tab.textContent = "---"; updateLines();
            listRender();
        } catch(e){}
    }

    async function listRender() {
        ui.innerHTML = '';
        let files = [];
        if(isDir && fHandle) {
            for await (const [n, h] of fHandle.entries()) {
                if(h.kind==='file' && n.toUpperCase().match(/\.(PRSH|PRSHX|TXT)$/)) files.push(h);
            }
        } else if(!isDir) files = [...filesCache];

        files.sort((a,b)=>a.name.localeCompare(b.name)).forEach(h => {
            const li = document.createElement('li');
            li.className='file-item';
            const i = h.name.match(/X$/i)?'üß©':'üìÑ';
            li.innerHTML = `<span>${i} ${h.name}</span><span class="del-btn">üóë</span>`;
            li.onclick = (e) => {
                if(e.target.className.includes('del')) return;
                load(h);
            };
            li.querySelector('.del-btn').onclick = async()=>{
                if(!confirm('–£–¥–∞–ª–∏—Ç—å?'))return;
                if(isDir) await fHandle.removeEntry(h.name);
                else filesCache = filesCache.filter(x=>x!=h);
                if(fileH==h) { ed.value=''; tab.textContent='---'; fileH=null; }
                listRender();
            };
            ui.appendChild(li);
        });
        if(files.length==0) ui.innerHTML = '<div style="padding:20px;text-align:center;color:#555">–ü—É—Å—Ç–æ</div>';
    }

    async function load(h) {
        fileH = h;
        const f = await h.getFile();
        ed.value = await f.text();
        tab.textContent = h.name;
        msg.textContent = h.name;
        updateLines();
    }

    async function save() {
        if(!fileH) return alert('–ù–µ—Ç —Ñ–∞–π–ª–∞');
        const w = await fileH.createWritable();
        await w.write(ed.value);
        await w.close();
        const t = msg.textContent; msg.textContent='–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!'; setTimeout(()=>msg.textContent=t,2000);
    }

    function showNew(){ 
        if(!isDir) return alert('–ù—É–∂–Ω–∞ –ø–∞–ø–∫–∞'); 
        document.getElementById('mod').style.display='block'; 
    }
    async function createFile(){
        let n = document.getElementById('fname').value;
        if(!n) return;
        if(!n.match(/\./)) n+='.PRSH';
        const nh = await fHandle.getFileHandle(n,{create:true});
        const w = await nh.createWritable(); await w.write('–ø—Ä–∏–≤–µ—Ç —Ç—ã —Ç–µ–ø–µ—Ä—å –Ω–µ chatGPT {\n\n}'); await w.close();
        document.getElementById('mod').style.display='none';
        listRender();
        load(nh);
    }

    document.addEventListener('keydown', e=>{if(e.ctrlKey&&e.key=='s'){e.preventDefault();save()}});
    updateLines(); // init
</script>
</body>
</html>
